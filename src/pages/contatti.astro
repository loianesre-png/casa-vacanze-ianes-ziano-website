---
/**
 * Contact Page
 * Displays contact form and location information
 *
 * Content is loaded from: src/content/dictionary/{locale}/contact.yaml
 * Contact info is loaded from: src/config/site.config.ts
 */
import Layout from '~/layouts/PageLayout.astro';
import CalendarForm from '~/components/widgets/CalendarForm';
import Features2 from '~/components/widgets/Features2.astro';
import HeroText from '~/components/widgets/HeroText.astro';

import { getContactContent, getCommonContent, getCurrentLocale } from '~/utils/content';
import { getContactEmail, getFormattedAddress, getSiteName, getContactPhone, getWhatsApp } from '~/config';

// Get current locale from URL
const currentLocale = getCurrentLocale(Astro.url);

// Load content from dictionary with current locale
const contactContent = await getContactContent(currentLocale);
const common = await getCommonContent(currentLocale);

// Get contact info from config
const email = getContactEmail();
const address = getFormattedAddress();
const siteName = getSiteName();
const phone = getContactPhone();
const whatsapp = getWhatsApp();

// Build form content props for CalendarForm
const formContent = {
  formTitle: contactContent.form.title,
  formSubtitle: contactContent.form.subtitle,
  disabledTitle: common.buttons.contact,
  disabledMessage: contactContent.messages.disabled,
  checkIn: common.labels.check_in,
  checkOut: common.labels.check_out,
  selectDate: common.form.select_date || 'Seleziona data',
  name: common.form.name,
  namePlaceholder: common.placeholders.name,
  email: common.form.email || 'Email',
  emailPlaceholder: common.placeholders.email,
  guests: common.form.guests_count || common.labels.guests,
  guestsPlaceholder: common.placeholders.guests,
  message: common.form.special_requests || contactContent.form.fields?.message?.label,
  messagePlaceholder: common.placeholders.message,
  submit: common.buttons.submit,
  submitting: common.buttons.submitting,
  successMessage: common.messages.success.form_sent,
  errorMessage: common.messages.error.form_error,
};

// Page metadata
const metadata = {
  title: `${contactContent.seo.title} - ${siteName}`,
  description: contactContent.seo.description,
};
---

<Layout metadata={metadata}>
  <!-- HeroText Widget ******************* -->
  <HeroText tagline={contactContent.page.tagline} title={contactContent.page.title} />

  <div
    class="max-w-3xl mx-auto text-center p-6 rounded shadow-lg bg-card border border-muted"
  >
    <CalendarForm client:idle content={formContent} />
  </div>

  <!-- Features2 Widget ************** -->
  <Features2
    title={contactContent.info.title}
    items={[
      {
        title: 'Email',
        description: email,
        icon: 'tabler:mail',
      },
      {
        title: 'Posizione',
        description: address,
        icon: 'tabler:map-pin',
      },
      ...(phone ? [{
        title: 'Telefono',
        description: `<a href="tel:${phone.replace(/\s/g, '')}" class="text-primary hover:text-accent transition-all duration-400">${phone}</a>`,
        icon: 'tabler:phone',
      }] : []),
      ...(whatsapp ? [{
        title: 'WhatsApp',
        description: `<a href="https://wa.me/${whatsapp.replace(/[\s+]/g, '')}" target="_blank" rel="noopener noreferrer" class="text-primary hover:text-accent transition-all duration-400">${whatsapp}</a>`,
        icon: 'tabler:brand-whatsapp',
      }] : []),
    ]}
  />
</Layout>
